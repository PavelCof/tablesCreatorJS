<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/taskboard.css">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="MoscowLoader/style.css">
    <link rel="shortcut icon" href="himgs/JKHeaders1.svg" type="image/x-icon">
    <title>КЖ Шапки</title>
</head>
<body>

    <div class="row" id="Hmenu"> <img src="himgs/JKHeaders1.svg" alt=""> <button id="addrow">Добавить столбец</button></div>
    <div id="itemBlue" class="hidden"><div class="itemBlue"></div></div>
    <h1 id="h1"> Настройка структуры журнала</h1>
    <div class="container" id="container" >
        <div class="column" id="column_7824330321525"  >

            <div class="item column" draggable="true" id="newStr12">    
                <div class="itemblock trH ">
                    <div class="td f3 move ofNotHidden"><input type="text" name="name" value="" autocomplete="off">  </div>
                    <div class="rollUpHeadre">
                        <img src="himgs/icorollUp.svg" class="rollUp" id="rollUp_${hpluseId}"></div>
                    <div class="td f3"></div>
                    <div class="td f2 minw175 padL7"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                </div> 


                <div class="item" draggable="true" id="item_78243303215251">
                
                    <div class="itemblock tr ">
                        <div class="td f3 move ofNotHidden"><div class="moveLeft">
                        <div class="leftToInp"></div>
                        </div> <input type="text" name="name" value="" autocomplete="off">  </div>
                        <div class="pluseHeadre"><img src="himgs/addplusegrey.svg" class="pluseH" id="pluseH_7824330321525"></div>
                        <div class="td f3">
                                <select name="ctype" list="columnTypes" class="columnTypes">
                                        <option value=""></option><option value="varchar">Текст</option><option value="int">Число</option><option value="checkbox">Чекбокс</option><option value="enum">Выпадающий список</option><option value="date">Дата</option><option value="time">Время</option><option value="global">Готовый список</option><option value="signature">Подпись</option><option value="chain">Связанный список</option>
                                </select>
                        </div>
                        <div class="td f2 minw175 padL7"><button class="bgbutton options" title="Добавьте права для редакторов столбца">Редактировать права</button></div>
                        <div class="td f2"><button class="bgbutton clonebutton">Дублировать</button> </div>
                        <div class="td f2 center">
                                <input type="checkbox" name="required" id="arch_7824330321525">
                        </div>
                        <div class="td f2 center"></div>
                        <div class="td f2 jright"><button class="rbutton delString">Удалить</button></div>
                    </div>
                
                </div> 
             <div class="item" draggable="true" id="item_60519337091961">
                    
                    <div class="itemblock tr ">
                        <div class="td f3 move ofNotHidden"><div class="moveLeft">
                        <div class="leftToInp2"></div>
                        </div> <input type="text" name="name" value="" autocomplete="off">  </div>
                        <div class="pluseHeadre"><img src="himgs/addplusegrey.svg" class="pluseH" id="pluseH_6051933709196"></div>
                        <div class="td f3">
                                <select name="ctype" list="columnTypes" class="columnTypes">
                                        <option value=""></option><option value="varchar">Текст</option><option value="int">Число</option><option value="checkbox">Чекбокс</option><option value="enum">Выпадающий список</option><option value="date">Дата</option><option value="time">Время</option><option value="global">Готовый список</option><option value="signature">Подпись</option><option value="chain">Связанный список</option>
                                </select>
                        </div>
                        <div class="td f2 minw175 padL7"><button class="bgbutton options" title="Добавьте права для редакторов столбца">Редактировать права</button></div>
                        <div class="td f2"><button class="bgbutton clonebutton">Дублировать</button> </div>
                        <div class="td f2 center">
                                <input type="checkbox" name="required" id="arch_6051933709196">
                        </div>
                        <div class="td f2 center"></div>
                        <div class="td f2 jright"><button class="rbutton delString">Удалить</button></div>
                    </div>
                
                </div>
                <div class="item" draggable="true" id="new1">    
                    <div class="itemblock tr ">
                        <div class="td f3  moveNoImg ofNotHidden"><div class="moveLeft ">
                        <div class="leftToBut"></div>
                        </div> <buttin class="bgbutton addstr">Добавить еще столбец  </buttin></div>
                        <div class="pluseHeadre"></div>
                        <div class="td f3"></div>
                        <div class="td f2 minw175 padL7"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                    </div> 
                </div>
        
            </div>
 
    
        </div>




        <div class="column" id="column_78243303215251"  >

            <div class="item column" draggable="true" id="newStr">    
                <div class="itemblock trH ">
                    <div class="td f3 move ofNotHidden"><input type="text" name="name" value="" autocomplete="off">  </div>
                    <div class="rollUpHeadre">
                        <img src="himgs/icorollUp.svg" class="rollUp" id="rollUp_${hpluseId}"></div>
                    <div class="td f3"></div>
                    <div class="td f2 minw175 padL7"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                    <div class="td f2"></div>
                </div> 


                <div class="item" draggable="true" id="item_7824330321525">
                
                    <div class="itemblock tr ">
                        <div class="td f3 move ofNotHidden"><div class="moveLeft">
                        <div class="leftToInp"></div>
                        </div> <input type="text" name="name" value="" autocomplete="off">  </div>
                        <div class="pluseHeadre"><img src="himgs/addplusegrey.svg" class="pluseH" id="pluseH_7824330321525"></div>
                        <div class="td f3">
                                <select name="ctype" list="columnTypes" class="columnTypes">
                                        <option value=""></option><option value="varchar">Текст</option><option value="int">Число</option><option value="checkbox">Чекбокс</option><option value="enum">Выпадающий список</option><option value="date">Дата</option><option value="time">Время</option><option value="global">Готовый список</option><option value="signature">Подпись</option><option value="chain">Связанный список</option>
                                </select>
                        </div>
                        <div class="td f2 minw175 padL7"><button class="bgbutton options" title="Добавьте права для редакторов столбца">Редактировать права</button></div>
                        <div class="td f2"><button class="bgbutton clonebutton">Дублировать</button> </div>
                        <div class="td f2 center">
                                <input type="checkbox" name="required" id="arch_7824330321525">
                        </div>
                        <div class="td f2 center"></div>
                        <div class="td f2 jright"><button class="rbutton delString">Удалить</button></div>
                    </div>
                
                </div> 
             <div class="item" draggable="true" id="item_60519337091963">
                    
                    <div class="itemblock tr ">
                        <div class="td f3 move ofNotHidden"><div class="moveLeft">
                        <div class="leftToInp2"></div>
                        </div> <input type="text" name="name" value="" autocomplete="off">  </div>
                        <div class="pluseHeadre"><img src="himgs/addplusegrey.svg" class="pluseH" id="pluseH_6051933709196"></div>
                        <div class="td f3">
                                <select name="ctype" list="columnTypes" class="columnTypes">
                                        <option value=""></option><option value="varchar">Текст</option><option value="int">Число</option><option value="checkbox">Чекбокс</option><option value="enum">Выпадающий список</option><option value="date">Дата</option><option value="time">Время</option><option value="global">Готовый список</option><option value="signature">Подпись</option><option value="chain">Связанный список</option>
                                </select>
                        </div>
                        <div class="td f2 minw175 padL7"><button class="bgbutton options" title="Добавьте права для редакторов столбца">Редактировать права</button></div>
                        <div class="td f2"><button class="bgbutton clonebutton">Дублировать</button> </div>
                        <div class="td f2 center">
                                <input type="checkbox" name="required" id="arch_6051933709196">
                        </div>
                        <div class="td f2 center"></div>
                        <div class="td f2 jright"><button class="rbutton delString">Удалить</button></div>
                    </div>
                
                </div>
                <div class="item" draggable="true" id="new3">    
                    <div class="itemblock tr ">
                        <div class="td f3  moveNoImg ofNotHidden"><div class="moveLeft ">
                        <div class="leftToBut"></div>
                        </div> <buttin class="bgbutton addstr">Добавить еще столбец  </buttin></div>
                        <div class="pluseHeadre"></div>
                        <div class="td f3"></div>
                        <div class="td f2 minw175 padL7"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                        <div class="td f2"></div>
                    </div> 
                </div>
        
            </div>
 
    
        </div>
    </div>

<script>
        let moveElementID=""
        const draggableElements = document.querySelectorAll('.item[draggable="true"]');

        draggableElements.forEach(elem => {
            elem.addEventListener('dragstart', dragStart);
            elem.addEventListener('dragend', dragEnd);
        });

        const containers = document.querySelectorAll('.column');
            containers.forEach(container => {
            container.addEventListener('dragover', dragOver);
        });

        containers.forEach(container => {
            container.addEventListener('dragenter', dragEnter);
            container.addEventListener('dragleave', dragLeave);
        });

        containers.forEach(container => {
            container.addEventListener('drop', dragDrop);
        });

        function dragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.id);
            console.log(event.target.id);
            moveElementID=event.target.id

        }

        function dragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function dragOver(event) {
            event.preventDefault();
             let el =event.target
             finalEl=el
           
           if(el.classList.contains("column")){
                try {
                    console.log(1);
                    finalEl.appendChild(itemBlue);
                    itemBlue.classList.remove("hidden")
                } catch (error) {
                    console.log(error);
                }

           }else{
            // if(el.parentNode.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode.parentNode
            //     console.log(1);
            // }else if(el.parentNode.parentNode.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode.parentNode.parentNode
            //     console.log(2);
            // }else if(el.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode
            //     console.log(3);
            // }else if(el.classList.contains("pluseH")){
            //     finalEl= el.parentNode.parentNode.parentNode
            //     console.log(5);
            // }else if(el.classList.contains("item")){
            //     finalEl= el.parentNode
            // }

 
                for (let index = 0; index < 20; index++) {
                    finalEl=finalEl.parentNode
         
                    if(finalEl.classList.contains('item')){
                       
                        break;
                    }

                }
               
      
            if (finalEl.parentNode.classList.contains('column')) {

            
                finalEl.insertAdjacentElement('afterend', itemBlue);
                itemBlue.classList.remove("hidden")
           
            }
           }
 


        }

        function dragEnter(event) {
            event.target.classList.add('drag-enter');
        }

        // Обработчик события dragleave
        function dragLeave(event) {
            event.target.classList.remove('drag-enter');
        }

        function dragDrop(event) {
                const target = event.target;
             //   if (target.classList.contains('column')) {
                   // console.log(target);
                    event.preventDefault();
                    event.target.classList.remove('drag-enter');
                    const draggableElementId = moveElementID//event.dataTransfer.getData('text/plain');
                    console.log(draggableElementId);
                    const draggableElement = document.getElementById(draggableElementId);
                   // console.log( itemBlue,draggableElementId);
                    itemBlue.insertAdjacentElement('afterend', draggableElement);
                    draggableElement.classList.remove('dragging');
               // }
        }
        </script>
</body>
</html>