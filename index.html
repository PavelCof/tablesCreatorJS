<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/taskboard.css">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="MoscowLoader/style.css">
    <link rel="shortcut icon" href="himgs/JKHeaders1.svg" type="image/x-icon">
    <title>КЖ Шапки</title>
</head>
<body>

    <div class="row" id="Hmenu"> <img src="himgs/JKHeaders1.svg" alt=""> <button id="addrow">Добавить столбец</button></div>
    <div id="itemBlue" class="hidden"><div class="itemBlue"></div></div>
    <h1 id="h1"> Настройка структуры журнала</h1>
    <div class="container" id="container" >
      



    </div>

<script>
        let moveElementID=""
        let draggableElements = document.querySelectorAll('.item[draggable="true"]');


        function initMoves() {
            moveElementID=""
            draggableElements = document.querySelectorAll('.item[draggable="true"]');

                draggableElements.forEach(elem => {
                    elem.addEventListener('dragstart', dragStart);
                    elem.addEventListener('dragend', dragEnd);
                });

                const containers = document.querySelectorAll('.column');
                containers.forEach(container => {
                    container.addEventListener('dragover', dragOver);
                });

                containers.forEach(container => {
                    container.addEventListener('dragenter', dragEnter);
                    container.addEventListener('dragleave', dragLeave);
                });

                containers.forEach(container => {
                    container.addEventListener('drop', dragDrop);
                });
        }
        function dragStart(event) {
            event.dataTransfer.setData('text/plain', event.target.id);
            moveElementID=event.target.id

        }

        function dragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function dragOver(event) {
            event.preventDefault();
             let el =event.target
             finalEl=el
             if(el.tagName=="IMG"){
                return;
            }
           if(el.classList.contains("column")){
                try {
                    console.log(1);
                    finalEl.appendChild(itemBlue);
                    itemBlue.classList.remove("hidden")
                } catch (error) {
                    console.log(error);
                }

           }else{
            // if(el.parentNode.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode.parentNode
            //     console.log(1);
            // }else if(el.parentNode.parentNode.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode.parentNode.parentNode
            //     console.log(2);
            // }else if(el.classList.contains("td")){
            //     finalEl= el.parentNode.parentNode
            //     console.log(3);
            // }else if(el.classList.contains("pluseH")){
            //     finalEl= el.parentNode.parentNode.parentNode
            //     console.log(5);
            // }else if(el.classList.contains("item")){
            //     finalEl= el.parentNode
            // }
            console.log(el.tagName);

                for (let index = 0; index < 200; index++) {
                    if (finalEl.parentNode) {
                                    finalEl=finalEl.parentNode
                        
                                
                                try {
                                    if(finalEl.classList.contains('item')||finalEl.classList.contains('trH')){ // 
                                        
                                        break;
                                    }
                                } catch (error) {
                                    
                                }


                            }else{
                                console.log(finalEl,finalEl.classList,finalEl.parentNode);
                            }
                        
                

                    }
                    if(finalEl.parentNode){
                        if (finalEl.parentNode.classList.contains('column')) {

                            if(finalEl.classList.contains('itemButtons')){
                                finalEl.insertAdjacentElement('beforebegin', itemBlue);
                            }else{
                                finalEl.insertAdjacentElement('afterend', itemBlue);
                            }

                            itemBlue.classList.remove("hidden")

                        }
                    }else{

                    }

                }
 


        }

        function dragEnter(event) {
            event.target.classList.add('drag-enter');
        }

        // Обработчик события dragleave
        function dragLeave(event) {
            event.target.classList.remove('drag-enter');
        }

        function dragDrop(event) {
                const target = event.target;
             //   if (target.classList.contains('column')) {
                   // console.log(target);
                    event.preventDefault();
                    try {
                        event.target.classList.remove('drag-enter');
                        const draggableElementId = moveElementID//event.dataTransfer.getData('text/plain');
                        console.log(draggableElementId);
                        const draggableElement = document.getElementById(draggableElementId);
                    // console.log( itemBlue,draggableElementId);
                        itemBlue.insertAdjacentElement('afterend', draggableElement);
                        draggableElement.classList.remove('dragging');
                        itemBlue.classList.add("hidden")
                    } catch (error) {
                        
                    }

               // }
        }

        initMoves()
        </script>

<script src="script/clicks.js"></script>
</body>
</html>